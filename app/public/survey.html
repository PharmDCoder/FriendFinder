<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Survey</title>

  <!-- Latest compiled and minified CSS & JS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

</head>

<body>

  <div class="container">

    <div class="jumbotron">
      <h1 class="text-center">
        <i class="fa fa-wpforms"></i> Survey Questions</h1>
      <hr>
      <div class="row">
        <div class="col-lg-12">
          <div class="card">
            <div class="card-header">
              About You
            </div>
            <div class="card-body">
              <form id="survey-form" role="form">
                <div class="form-group">
                  <label for="user-name">Name (Required)</label>
                  <input type="text" class="form-control" id="user-name">
                </div>
                <div class="form-group">
                  <label for="photo-link">Link to Photo Image (Required)</label>
                  <input type="text" class="form-control" id="photo-link">
                </div>
              </form>
            </div>
            <div class="card-header">
              Survey Questions
            </div>
            <div class="card-body">
              <div class="form-group">
                <h5>Question 1</h2>
                  <label for="question-1">Your mind is always buzzing with unexplored ideas and plans.</label>
                  <select class="form-control" id="question-1">
                    <option value="" selected disabled>Please select</option>
                    <option>1 (Strongly Agree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Disagree)</option>
                  </select>
              </div>
              <div class="form-group">
                <h5>Question 2</h2>
                  <label for="question-2">Generally speaking, you rely more on your experience than your
                    imagination.</label>
                  <select class="form-control" id="question-2">
                    <option value="" selected disabled>Please select</option>
                    <option>1 (Strongly Agree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Disagree)</option>
                  </select>
              </div>
              <div class="form-group">
                <h5>Question 3</h2>
                  <label for="question-3">You find it easy to stay relaxed and focused even when there is some
                    pressure.</label>
                  <select class="form-control" id="question-3">
                    <option value="" selected disabled>Please select</option>
                    <option>1 (Strongly Agree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Disagree)</option>
                  </select>
              </div>
              <div class="form-group">
                <h5>Question 4</h2>
                  <label for="question-4">You rarely do something just out of sheer curiosity.</label>
                  <select class="form-control" id="question-4">
                    <option value="" selected disabled>Please select</option>
                    <option>1 (Strongly Agree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Disagree)</option>
                  </select>
              </div>
              <div class="form-group">
                <h5>Question 5</h2>
                  <label for="question-5">People can rarely upset you.</label>
                  <select class="form-control" id="question-5">
                    <option value="" selected disabled>Please select</option>
                    <option>1 (Strongly Agree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Disagree)</option>
                  </select>
              </div>
              <div class="form-group">
                <h5>Question 6</h2>
                  <label for="question-6">It is often difficult for you to relate to other people’s feelings.</label>
                  <select class="form-control" id="question-6">
                    <option value="" selected disabled>Please select</option>
                    <option>1 (Strongly Agree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Disagree)</option>
                  </select>
              </div>
              <div class="form-group">
                <h5>Question 7</h2>
                  <label for="question-7">In a discussion, truth should be more important than people’s
                    sensitivities.</label>
                  <select class="form-control" id="question-7">
                    <option value="" selected disabled>Please select</option>
                    <option>1 (Strongly Agree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Disagree)</option>
                  </select>
              </div>
              <div class="form-group">
                <h5>Question 8</h2>
                  <label for="question-8">You rarely get carried away by fantasies and ideas.</label>
                  <select class="form-control" id="question-8">
                    <option value="" selected disabled>Please select</option>
                    <option>1 (Strongly Agree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Disagree)</option>
                  </select>
              </div>
              <div class="form-group">
                <h5>Question 9</h2>
                  <label for="question-9">You think that everyone’s views should be respected regardless of whether they
                    are supported by facts or not.</label>
                  <select class="form-control" id="question-9">
                    <option value="" selected disabled>Please select</option>
                    <option>1 (Strongly Agree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Disagree)</option>
                  </select>
              </div>
              <div class="form-group">
                <h5>Question 10</h2>
                  <label for="question-10">You feel more energetic after spending time with a group of people.</label>
                  <select class="form-control" id="question-10">
                    <option value="" selected disabled>Please select</option>
                    <option>1 (Strongly Agree)</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Disagree)</option>
                  </select>
              </div>
              <button class="btn btn-primary submit" data-toggle="modal" data-target="#results-modal">Submit</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal fade" id="results-modal" tabindex="-1" role="dialog" aria-labelledby="results-modalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="modal-title" id="results-modalLabel">Survey Results</h3>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <h5 id="match-name"></h5>
              <img src="" id="match-image" alt="Match Image" class="img-fluid">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>


      <footer class="footer">
        <div class="container">
          <p><a href="/api/results">API Friends Link</a> | <a
              href="https://github.com/PharmDCoder?tab=repositories">Github Repo</a>
        </div>
      </footer>

    </div>

</body>

</html>

<!-- BELOW CODE HANDLES HOW FORM DATA IS SENT TO OUR SERVER -->
<script type="text/javascript">
  // In this code below we create the Front-end JavaScript which "POSTS" our form data to our express server.
  // In essence, when the user hits submit, jQuery grabs all of the fields then sends a post request to our api
  // Our api recognizes the route (/api/survey)... and then runs the associated code (found in api-routes.js).
  // In this case the associated code "saves" the data to the friends.js file

  $(".submit").on("click", function (event) {
    //prevents default action of refreshing the page when clicked 
    event.preventDefault();

    // Here we grab the form elements
    var newFriend = {
      name: $("#user-name").val().trim(),
      photo: $("#photo-link").val().trim(),
      scores: [$("#question-1 :selected").text().substring(0, 1), $("#question-2 :selected").text().substring(0, 1), $("#question-3 :selected").text().substring(0, 1), $("#question-4 :selected").text().substring(0, 1),
      $("#question-5 :selected").text().substring(0, 1), $("#question-6 :selected").text().substring(0, 1), $("#question-7 :selected").text().substring(0, 1), $("#question-8 :selected").text().substring(0, 1),
      $("#question-9 :selected").text().substring(0, 1), $("#question-10 :selected").text().substring(0, 1)]
    }

    // Here we call the friendMatch function to compare user results to hard-coded friend data
    friendMatch(newFriend);
    
    // The $.post method allows us to send the data (newFriend object) collected in the survey to the apiRoute.js file

    $.post("/api/results", newFriend,
      function (data) {
        console.log("friend added");
      });


  });

  //This function compares the newFriend object submitted in the survey to the hard coded friends' data to find the smallest absolute value (closest match)
  function friendMatch(newFriend) {
    //uses the .get method to pull the hard coded friends data
    $.get("/api/results", function (data) {
      //setting global variables for the current best match and match score
      var currentMatch;
      //setting initial currentMatchScore to a value to prevent null
      var currentMatchScore = 50;
      //loops through the hard coded friends data array
      data.forEach((potentialMatch) => {
        //setting local variable to add up the scores of the friend currently being compared to newFriend object
        var matchTotal = 0;
        //loop that loops through the scores of each current hard coded friend to the scores of the newFriend and finds absolute value of the difference to set to new match Total
        for (let index = 0; index < 10; index++) {
          matchTotal += Math.abs(potentialMatch.scores[index] - newFriend.scores[index]);
        }
        console.log("Match Total " + matchTotal);
        console.log("Match currentMatchScore " + currentMatchScore);
        //if the current matchTotal is less than the currentMatchScore it will replace the current friend match with the most recently compared friend
        if (matchTotal < currentMatchScore) {
          currentMatchScore = matchTotal;
          currentMatch = potentialMatch;
          console.log("You have a new Match" + currentMatch.name);
        }
      });
      //pushes the closest match name and image to the results modal
      $("#match-name").text(currentMatch.name);
      $("#match-image").attr("src", currentMatch.photo);
      })
    };

</script>